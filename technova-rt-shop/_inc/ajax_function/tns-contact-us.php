<?phpadd_action('wp_ajax_nopriv_tns_contact_us','tns_contact_us');add_action('wp_ajax_tns_contact_us','tns_contact_us');function tns_contact_us() {	if (!isset($_POST['nonce']) && !wp_verify_nonce($_POST['nonce'])){		die('access dined');	}	$validation = tns_contact_us_validate($_POST);	if ( $validation !== true ) {		wp_send_json( $validation, 403 );		wp_die();	}	$name = sanitize_text_field($_POST['name']);	$email = sanitize_text_field($_POST['email']);	$phone = sanitize_text_field($_POST['phone']);	$subject =  sanitize_text_field($_POST['subject']);	$message = sanitize_textarea_field($_POST['message']);	$headers = [ 'Content-Type: text/html; charset=UTF-8' ];	$to = get_option('_tns_settings_set_smtp')['username'];	$send_mail = wp_mail	(		$to,		$subject,		Tns_Mail_Layout::tns_contact_us_layout($name,$email,$phone,$subject,$message),		$headers	);	if ( $send_mail ) {		wp_send_json( [ 'success' => true, 'message' => 'پیام شما ارسال شد!' ], 200 );	} else {		wp_send_json( [ 'error' => true, 'message' => 'خطا در ارسال ایمیل. لطفا مجدد تلاش کنید' ], 403 );	}	wp_die();}// VALIDATEfunction tns_contact_us_validate($data) {	if (empty($data)){		return [ 'error' => true, 'message' => 'پر کردن تمامی فیلد ها الزامی است!' ];	}	if ( empty( $data['email'] ) ) {		return [ 'error' => true, 'message' => 'ایمیل را وارد کنید!' ];	}	if ( empty( $data['name'] ) ) {		return [ 'error' => true, 'message' => 'نام و نام خانوادگی خود را وارد کنید!' ];	}	if ( empty( $data['subject'] ) ) {		return [ 'error' => true, 'message' => 'موضوع پیام را وارد کنید!' ];	}	if ( empty( $data['message'] ) ) {		return [ 'error' => true, 'message' => 'پیام خود را بنویسید' ];	}	if ( ! is_email( $data['email'] ) ) {		return [ 'error' => true, 'message' => 'لطفا یک آدرس ایمیل معتبر وارد کنید' ];	}	if ( strlen( $data['message'] ) < 10 ) {		return [ 'error' => true, 'message' => 'پیام شما باید حداقل ۱۰ کاراکتر داشته باشد' ];	}	if (!preg_match('/^(0|09|\+)[0-9]{8,10}$/',$data['phone'])){		return ['error'=>true , 'message'=>'لطفا شماره موبایل معتبر خود را وارد کنید!'];	}	return true;}